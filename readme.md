# 아이온텍 급이기 (BFC700, BPC100)

## 개요

본 프로젝트는 아이온텍 급이기 프로토콜을 Node.js로 구현하기 위한 프로젝트이다.

프로토콜 관련 문서는 ~~[103_분만사급이기 프로토콜.xlsx](./Documents/103_분만사급이기 프로토콜.xlsx)~~ [BFC700_프로토콜_230821.xlsx](./Documents/BFC700_프로토콜_230821.xlsx)이다.

테스트 결과 문서는 [BFC700_프로토콜_230821_테스트결과.xlsx](./Documents/BFC700_프로토콜_230821_테스트결과.xlsx)이다.

## 개략적인 설명

모돈 관련 데이터는 **./sow_data** 위치에 저장된다고 가정한다. **./sow_data** 폴더 아래에 분만사 모돈 정보는 **./sow_data/farrowing** 아래에, 임신사 모돈 정보는 **./sow_data/pregnants**아래에 저장한다. 원활한 동작을 위해서 **./sow_data** 위치에 모돈 관련 정보가 프로토콜에 맞게 저장되어 있어야한다. 파일 형식은 *"json"* 형식으로 저장된다. 

## 동작 설명

**./sow_data** 폴더 아래 모돈 정보를 가져와 각 모돈 정보마다 하나의 Class를 생성하고, 필요한 정보를 취득한다.

급이기와 연결은 Serial Port를 통하여 이루어지며, 1개의 Serial Port만 있다고 가정한다. 따라서 모든 Class 들은 하나의 Serial Port를 통하여 통신을 한다.

 [iontec_feeder_farrowing.js](./iontec_feeder_farrowing.js) 파일에는 분만사 급이기와 연결하기 위한 프로토콜이 구현되어 있다.

[iontec_feeder_pregnant.js](./iontec_feeder_pregnant.js) 파일에는 임신사 급이기와 연결하기 위한 프로토콜이 구현되어 있다.

[index.js](./index.js) 파일에는 Sreial Port 관련 구현과, 각 모돈 정보를 읽고, 개체 연결하는 과정이 구현되어 있다.

## 테스트

2023년 11월 14일 현재 분만사 급이기 BFC700에 대해서만 테스트가 진행 되었다.

테스트 결과 프로토콜 문서 상에 응답이 있다고 정의되어 있으나, 응답이 없는 프로토콜 **급이 테이블 정보, 음수 테이블 정보** 두가지는 프로토콜 특성 상(연결되어 있는 모든 급이기에 동일 설정이 Write 됨) 응답이 발생하기 어려운 구조임. 아이온텍에 확인한 결과 두 프로토콜은 3초 간격으로 5회 전송한다고 함.

터치 횟수 관련하여 2 Byte를 사용하나, 테스트 결과 1 Byte만 사용함. 현 테스트 장비는 1Byte만 사용한다고 아이온텍으로 부터 회신 받음. 최신 펌웨어가 적용된 급이기는 2 Byte로 동작한다고 함.

테스트 과정에서 의문 사항을 주고 받은 메일 사본 [아이온텍 분만사 급이기 프로토콜 테스트 결과](./Documents/주식회사 엠트리센 메일 - [M3SEN] 아이온텍 분만사 급이기 프로토콜 테스트 결과.pdf)에 있음.

## 향 후 진행 사항

임신사와 분만사 프로토콜이 거의 같음. 따라서 하나의 Class로 통합 작업 필요.

웹 페이지 상에서 수정 및 적용 기능 추가 필요

  
